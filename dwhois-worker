#!/usr/bin/python

from dwhois.whois import whois, WhoisError
from dwhois.timing import PoissonRateLimiter
from dwhois.worker import work_queue, push_results
from dwhois.config import user,password,average_time,request_url,upload_base_url

for domain in work_queue(request_url, user, password):
    print 'Processing %s' % domain

    with PoissonRateLimiter(average_time):
        try:
            push_results(domain, whois(domain), upload_base_url, user, password)
        except WhoisError, e:
            print e.message
